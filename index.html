<!DOCTYPE html>
<html>
<head>
	<title>EPC-Lab</title>
	<style type="text/css">
		body {
			background-image: url('https://cdn.discordapp.com/attachments/493512163319742464/1021542935826792579/unknown.png');
			background-size: cover;
			background-repeat: no-repeat;
			background-position: center center;
		}

		h1 {
			font-size: 48px;
			text-align: center;
			margin-top: 200px;
			color: white;
			text-shadow: 2px 2px black;
		}

		button {
			font-size: 24px;
			padding: 10px;
			margin: 10px;
			background-color: white;
			border: none;
			border-radius: 10px;
			cursor: pointer;
		}

		#login-btn {
			margin-top: 100px;
			margin-left: 50%;
			transform: translateX(-50%);
		}

		#profile-btn {
			margin-top: 10px;
			margin-left: 50%;
			transform: translateX(-50%);
		}

		#logout-btn {
			margin-top: 10px;
			margin-left: 50%;
			transform: translateX(-50%);
		}
	</style>
	<script type="text/javascript">
		function login() {
  if (!localStorage.getItem('discord_token')) {
    window.location.href = '/login';
  } else {
    showProfile();
  }
}

		function logout() {
			localStorage.removeItem("access_token");
			location.reload();
		}

		function getProfile() {
			var access_token = localStorage.getItem("access_token");
			if (access_token) {
				fetch("https://discordapp.com/api/users/@me", {
					headers: {
						"Authorization": "Bearer " + access_token
					}
				})
				.then(response => response.json())
				.then(data => {
					document.getElementById("profile-btn").innerHTML = data.username;
					document.getElementById("profile-btn").style.display = "inline-block";
					document.getElementById("profile-btn").onclick = function() {
						window.location.href = "profile.html";
					}
					document.getElementById("logout-btn").style.display = "inline-block";
				})
				.catch(error => {
					console.log(error);
				});
			}
		}

		window.onload = function() {
			getProfile();
		}
	</script>
</head>
<body>
	<h1>EPC-Lab</h1>
	<button onclick="login()" id="login-btn">Login with Discord</button>
	<button onclick="location.href='tasks.html'" id="tasks-btn">Tasks</button>
	<button onclick="logout()" id="logout-btn" style="display: none;">Logout</button>
	<button id="profile-btn" style="display: none;"></button>
</body>
</html>

